<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 위치와 주변 동물병원</title>
    <style>
        #map { width: 100%; height: 500px; }
    </style>
</head>
<body>

<h1>내 위치와 주변 동물병원</h1>
<div id="map"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- 타임리프를 사용해 JavaScript에 클라이언트 ID 삽입 -->
<script th:inline="javascript">
    const naverMapClientId = /*[[${naverMapClientId}]]*/ 'default_client_id';
</script>

<script>
    function loadNaverMap() {
        const script = document.createElement('script');
        script.src = `https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${naverMapClientId}`;
        script.onload = function() {
            getUserLocation();  // 현재 위치 가져오기
        };
        document.head.appendChild(script);
    }

    // 사용자 현재 위치 가져오기
    function getUserLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                const userLat = position.coords.latitude;
                const userLon = position.coords.longitude;
                initMap(userLat, userLon);  // 현재 위치를 중심으로 지도 초기화
            }, showError);
        } else {
            alert("이 브라우저는 Geolocation을 지원하지 않습니다.");
        }
    }

    // 위치 가져오기 실패 시 기본 위치 설정
    function showError() {
        alert("현재 위치를 가져올 수 없습니다. 기본 위치(서울)로 설정합니다.");
        initMap(37.5665, 126.9780);  // 서울 중심으로 기본 설정
    }

    // 지도 초기화
    function initMap(userLat, userLon) {
        const mapOptions = {
            center: new naver.maps.LatLng(userLat, userLon),  // 현재 위치를 중심으로 설정
            zoom: 15  // 기본 줌 레벨 설정
        };

        const map = new naver.maps.Map('map', mapOptions);

        // 사용자 위치에 마커 추가
        const userMarker = new naver.maps.Marker({
            position: new naver.maps.LatLng(userLat, userLon),
            map: map,
            title: "내 위치",
            icon: {
                content: '<div style="background-color:red;width:20px;height:20px;border-radius:50%;"></div>',
                anchor: new naver.maps.Point(10, 10)
            }
        });

        // 병원 데이터 추가 작업
        loadHospitals(map);
    }

    function loadHospitals(map) {
        // 병원 데이터 불러와서 마커 추가하는 함수
        console.log("병원 데이터를 불러옵니다.");
    }

    loadNaverMap();  // 네이버 지도 로드 시작
</script>

</body>
</html>
